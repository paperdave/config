#!/bin/bash
# bd: run bun-debug with dave's opinionated defaults
src=$HOME/bun
file=$src/packages/debug-bun-darwin-aarch64/bun-debug
temp=/tmp

if ! env | grep "BUN_DEBUG_" -q; then
  export BUN_DEBUG_QUIET_LOGS=1
fi

if [ ! -f $file ]; then
  echo "someone forgot to compile! run make dev in bun"
  exit 1
fi

if [ ! -d $temp/bun-debug-path ]; then
  mkdir -p $temp/bun-debug-path
  ln -s $file $temp/bun-debug-path/bun
fi

printf "\e[0;30mbun-debug(%s) [compiled %s]\e[0m\n" "$(cd $src; git rev-parse --abbrev-ref HEAD)" "$(date -r $file +"%F %H:%M")" >&2
PATH=$temp/bun-debug-path:$PATH exec bun "$@"
